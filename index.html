<!doctype html>
<html lang="si">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DRK OFC - Join Application</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&family=Libre+Franklin:wght@300;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f0f10;
      --card:#111214;
      --accent:#d80000; /* red accent */
      --muted:#bfc4c8;
      --glass: rgba(255,255,255,0.03);
    }
    *{box-sizing:border-box;font-family: 'Libre Franklin', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      margin:0;
      min-height:100vh;
      background: linear-gradient(180deg,#0b0b0c 0%, #121212 100%);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#e9eef2;
      padding:24px;
    }

    .wrap{
      width:100%;
      max-width:920px;
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:28px;
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:16px;
      padding:22px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.03);
    }

    /* LOGIN CARD */
    .login-card{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:12px;
    }
    .avatar-wrap{
      position:relative;
      width:96px;
      height:96px;
      border-radius:50%;
      overflow:hidden;
      background:linear-gradient(135deg,var(--glass), rgba(255,255,255,0.02));
      border:4px solid rgba(255,255,255,0.03);
    }
    .avatar-wrap img{ width:100%; height:100%; object-fit:cover; display:block;}
    .avatar-input{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
      text-align:center;
    }

    .field{ width:100%; margin-top:6px; }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input[type="text"], input[type="password"], input[type="tel"], input[type="file"]{
      width:100%;
      padding:10px 12px;
      border-radius:10px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.05);
      color: #e9eef2;
      outline:none;
    }
    input[type="file"]{ padding:8px; }
    .btn{
      display:inline-block;
      padding:10px 16px;
      border-radius:10px;
      background:var(--accent);
      color:white;
      font-weight:700;
      border:none;
      cursor:pointer;
      box-shadow: 0 6px 18px rgba(216,0,0,0.18);
    }
    .note { font-size:12px; color:#ffdddd; text-align:center; margin-top:6px; }

    /* APPLICATION CARD */
    .app-head{
      text-align:center;
      margin-bottom:12px;
    }
    .app-title{
      font-family: 'Montserrat', sans-serif;
      font-size:28px;
      letter-spacing:1px;
      font-weight:800;
      color:var(--accent);
      margin:0;
    }
    .app-sub{
      color:var(--muted);
      margin-top:6px;
      font-size:13px;
    }

    .form-grid{ display:grid; gap:12px; margin-top:8px; }
    .small{ font-size:13px; color:var(--muted); margin-bottom:6px; }
    .required{ color:#ff6b6b; margin-left:6px; font-weight:700; font-size:12px; }

    .success{
      display:none;
      padding:12px;
      border-radius:10px;
      background:linear-gradient(90deg, rgba(24,120,24,0.12), rgba(24,120,24,0.06));
      color:#cfead1;
      border:1px solid rgba(24,120,24,0.14);
    }

    footer { text-align:center; margin-top:12px; color:var(--muted); font-size:12px; }

    @media(max-width:880px){
      .wrap{ grid-template-columns:1fr; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- LOGIN -->
    <div class="card login-card" id="loginCard">
      <div class="avatar-wrap" title="Upload profile photo (optional)">
        <img id="loginAvatar" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect fill='%230f0f10' width='100%25' height='100%25'/><text x='50%25' y='50%25' fill='%23bbb' font-size='26' text-anchor='middle' dominant-baseline='middle'>DRK</text></svg>" alt="avatar">
      </div>
      <div class="avatar-input small">
        <input id="avatarFile" type="file" accept="image/*">
      </div>

      <div style="width:100%; margin-top:6px;">
        <div class="field">
          <label>USERNAME</label>
          <input id="username" type="text" placeholder="Type username exactly (DRK OFFICIAL)">
        </div>
        <div class="field">
          <label>PASSWORD</label>
          <input id="password" type="password" placeholder="Type password exactly (DRK OFFICIAL)">
        </div>
        <div style="display:flex; gap:8px; margin-top:12px;">
          <button class="btn" id="loginBtn">LOGIN</button>
          <button class="btn" id="clearBtn" style="background:#525252">CLEAR</button>
        </div>
        <div class="note" id="loginNote">User & Password must be <strong>DRK OFFICIAL</strong> (spaces & capitals important).</div>
      </div>
    </div>

    <!-- APPLICATION -->
    <div class="card" id="appCard" style="display:none;">
      <div class="app-head">
        <h1 class="app-title">DRK OFC JOIN APLICATION</h1>
        <div class="app-sub">ඔබගේ විස්තර පුරවන්න — "ස්ටේටස් විව්ස්" හා "WhatsApp" අංකය සහ ෆොටෝ 2 ක් අවශ්‍යයි.</div>
      </div>

      <form id="applicationForm" class="form-grid">
        <div>
          <label class="small">YOUR STATUS VIEWS NAME</label>
          <input id="statusName" name="statusName" type="text" placeholder="ස්ටේටස් විව්ස් නම ඇතුලත් කරන්න" required>
        </div>

        <div>
          <label class="small">YOUR WHATSAPP NUMBER</label>
          <input id="whatsapp" name="whatsapp" type="tel" placeholder="ඔයාගෙ වට්සැප් අන්කය  දාන්න" required>
        </div>

        <div>
          <label class="small">UPLOAD YOUR FACE PHOTOS <span class="required">[ මෙය අනිවාර්ය්‍ය වේ ]</span></label>
          <input id="face1" name="face1" type="file" accept="image/*" required>
          <div style="height:8px;"></div>
          <input id="face2" name="face2" type="file" accept="image/*" required>
        </div>

        <div>
          <label class="small">COMMENTS (optional)</label>
          <input id="comments" name="comments" type="text" placeholder="ඔබට කියන්න තියෙනවම්">
        </div>

        <div style="display:flex; gap:10px; align-items:center; margin-top:6px;">
          <button type="button" class="btn" id="sendBtn">SEND APPLICATION</button>
          <div id="statusMsg" class="success">Application prepared. පසුගිය සඳහන් සඳහාවට බලන්න.</div>
        </div>

        <div style="margin-top:6px; font-size:13px; color:var(--muted);">
          <strong>Note:</strong> This form will try to <em>automatically</em> send an email using <code>EmailJS</code> if you configure your EmailJS credentials in the script (see comments). If not configured, a ZIP file (containing photos + info) will be created for download and your mail client will be opened to send the application to <strong>dinethnimsara281@gmail.com</strong>. (Browser security prevents auto-attaching files into the user's mail client.)
        </div>
      </form>

      <footer>DRK OFFC • High quality submission — red accent UI</footer>
    </div>
  </div>

  <!-- Libraries for fallback zip creation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.0/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <!-- Optional EmailJS SDK: to enable automatic email sending from client-side (requires you to sign-up at https://www.emailjs.com and replace IDs below) -->
  <script src="https://cdn.emailjs.com/sdk/3.2.0/email.min.js"></script>

  <script>
    // ---------- LOGIN LOGIC ----------
    const LOGIN_USER = "DRK OFFICIAL";
    const LOGIN_PASS = "DRK OFFICIAL";

    const loginBtn = document.getElementById('loginBtn');
    const clearBtn = document.getElementById('clearBtn');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const loginCard = document.getElementById('loginCard');
    const appCard = document.getElementById('appCard');
    const avatarFile = document.getElementById('avatarFile');
    const loginAvatar = document.getElementById('loginAvatar');

    avatarFile.addEventListener('change', e => {
      const f = e.target.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      loginAvatar.src = url;
    });

    clearBtn.addEventListener('click', ()=> {
      usernameInput.value = '';
      passwordInput.value = '';
      avatarFile.value = '';
      loginAvatar.src = "data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'><rect fill='%230f0f10' width='100%25' height='100%25'/><text x='50%25' y='50%25' fill='%23bbb' font-size='26' text-anchor='middle' dominant-baseline='middle'>DRK</text></svg>";
    });

    loginBtn.addEventListener('click', () => {
      const u = usernameInput.value.trim();
      const p = passwordInput.value.trim();

      // Exact match including spaces and capitals => use direct equality
      if (u === LOGIN_USER && p === LOGIN_PASS) {
        // success
        loginCard.style.display = 'none';
        appCard.style.display = 'block';
        window.scrollTo({ top:0, behavior:'smooth' });
      } else {
        alert('Login failed — username/password must be exactly: DRK OFFICIAL (spaces and capitals required).');
      }
    });

    // ---------- APPLICATION SUBMIT LOGIC ----------
    const sendBtn = document.getElementById('sendBtn');
    const applicationForm = document.getElementById('applicationForm');
    const statusMsg = document.getElementById('statusMsg');

    // ---- EmailJS configuration (optional) ----
    // To enable auto-email from client, sign up at https://www.emailjs.com
    // Then replace the placeholders below:
    const USE_EMAILJS = false; // set true if you set EmailJS IDs
    const EMAILJS_USER_ID = 'YOUR_EMAILJS_USER_ID';      // e.g. 'user_xxx'
    const EMAILJS_SERVICE_ID = 'YOUR_SERVICE_ID';       // e.g. 'service_xxx'
    const EMAILJS_TEMPLATE_ID = 'YOUR_TEMPLATE_ID';     // e.g. 'template_xxx'
    // Template should accept fields: statusName, whatsapp, comments, and attachments (file inputs named face1, face2)
    if (USE_EMAILJS && (EMAILJS_USER_ID && EMAILJS_USER_ID !== 'YOUR_EMAILJS_USER_ID')) {
      try {
        emailjs.init(EMAILJS_USER_ID);
      } catch(e){
        console.warn('EmailJS init failed', e);
      }
    }

    sendBtn.addEventListener('click', async () => {
      // validate required fields
      const statusName = document.getElementById('statusName').value.trim();
      const whatsapp = document.getElementById('whatsapp').value.trim();
      const face1 = document.getElementById('face1').files[0];
      const face2 = document.getElementById('face2').files[0];
      const comments = document.getElementById('comments').value.trim();

      if (!statusName || !whatsapp) {
        alert('කරුණාකර ඔබේ නම සහ වට්සැප් අංකය පුරවන්න.');
        return;
      }
      if (!face1 || !face2) {
        alert('කරුණාකර දෙපේාරූ ෆොටෝ 2 ක් upload කරන්න — මෙය අනිවාර්ය වේ.');
        return;
      }

      // If EmailJS is configured (user's choice), try to send directly
      if (USE_EMAILJS && EMAILJS_SERVICE_ID !== 'YOUR_SERVICE_ID' && EMAILJS_TEMPLATE_ID !== 'YOUR_TEMPLATE_ID') {
        try {
          // Build a FormData and use emailjs sendForm or send with attachments
          // NOTE: EmailJS client-side attachment support varies — follow EmailJS docs and create a template with file inputs
          const fd = new FormData();
          fd.append('statusName', statusName);
          fd.append('whatsapp', whatsapp);
          fd.append('comments', comments);
          fd.append('face1', face1, face1.name);
          fd.append('face2', face2, face2.name);

          // emailjs.sendForm expects a <form>. We'll create a temporary form.
          const tmpForm = document.createElement('form');
          tmpForm.style.display = 'none';
          tmpForm.appendChild(document.getElementById('statusName').cloneNode());
          tmpForm.appendChild(document.getElementById('whatsapp').cloneNode());
          // instead, use emailjs.send (advanced) — but EmailJS SDK doc specifics are needed.
          // For simplicity we'll attempt sendForm:
          emailjs.sendForm(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, applicationForm)
          .then(function(){ 
            alert('Application sent automatically via EmailJS to dinethnimsara281@gmail.com');
            statusMsg.style.display = 'block';
          }, function(err){
            console.error('EmailJS error:', err);
            alert('EmailJS send failed — falling back to manual download + mailto.');
            fallbackCreateZipAndMail({statusName, whatsapp, comments, face1, face2});
          });

          return;
        } catch (e) {
          console.warn('EmailJS exception', e);
          // fallback below
        }
      }

      // Default fallback: create ZIP (info + images) and open mail client with mailto to let user attach the zip.
      fallbackCreateZipAndMail({statusName, whatsapp, comments, face1, face2});
    });

    async function fallbackCreateZipAndMail({statusName, whatsapp, comments, face1, face2}) {
      try {
        const zip = new JSZip();
        // add text info file
        const infoTxt = `STATUS NAME: ${statusName}\nWHATSAPP: ${whatsapp}\nCOMMENTS: ${comments}\nSUBMIT TO: dinethnimsara281@gmail.com\nSUBMITTED_AT: ${new Date().toISOString()}\n`;
        zip.file("application_info.txt", infoTxt);

        // add images as-is
        const f1 = await readFileAsArrayBuffer(face1);
        const f2 = await readFileAsArrayBuffer(face2);
        zip.file(sanitizeFilename(face1.name || 'face1.jpg'), f1);
        zip.file(sanitizeFilename(face2.name || 'face2.jpg'), f2);

        const blob = await zip.generateAsync({type:"blob", compression: "DEFLATE", compressionOptions:{level:6}});
        const filename = `DRK_application_${Date.now()}.zip`;
        saveAs(blob, filename);

        // prepare mailto
        const subject = encodeURIComponent('DRK OFC - New Join Application');
        const bodyLines = [
          `Hello,`,
          ``,
          `I have prepared my application for DRK OFC.`,
          `STATUS NAME: ${statusName}`,
          `WHATSAPP: ${whatsapp}`,
          `COMMENTS: ${comments}`,
          ``,
          `I have downloaded the application ZIP named: ${filename}`,
          `Please attach it to an email and send to: dinethnimsara281@gmail.com`,
          ``,
          `-- Sent from DRK OFC application page`
        ];
        const body = encodeURIComponent(bodyLines.join('\n'));
        // Open mail client
        window.location.href = `mailto:dinethnimsara281@gmail.com?subject=${subject}&body=${body}`;

        alert('ZIP downloaded. ඔබේ mail client එක open වෙන් අතර, download කල ZIP එක attach කරගෙන dinethnimsara281@gmail.com වෙත mail එක යවන්න.');
        statusMsg.style.display = 'block';
      } catch (err) {
        console.error(err);
        alert('අවසන් fallback දෝෂයක් — console වල error බලන්න.');
      }
    }

    function readFileAsArrayBuffer(file) {
      return new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => resolve(fr.result);
        fr.onerror = reject;
        fr.readAsArrayBuffer(file);
      });
    }

    function sanitizeFilename(name) {
      return name.replace(/[<>:"/\\|?*\x00-\x1F]/g, '_').slice(0,120);
    }
  </script>
</body>
  </html>
